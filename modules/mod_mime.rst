mod_mime 模块
=============

总结
----

``mod_mime`` 模块将 URI 中的文件名或者文件匹配模式映射成元数据值。
再将元数据分配给 HTTP 响应消息的选定内容。
比如响应文件的扩展名通常指定了媒体类型，表达语言，字符集和内容编码。
这些元信息通过包含在 HTTP 响应消息中发送；
在面临多个选择时，参与内容协商；
保证从多选一时，能够充分尊重用户的偏好。

.. note:: 元数据主要指媒体类型，表达语言，字符集和内容编码。

``Add*`` 指令（如 AddCharset）将扩展名映射为文件的元数据值以及控制提供文档的模块或脚本。
这些指令可以设置字符集，内容编码，内容语言以及文档媒体类型；
同时定义解析器和过滤器，用于生成和处理响应内容。
``TypesConfig`` 指定一个文件，该文件存储了扩展名到媒体类型的映射。

``MultiviewsMatch`` 可以控制 ``Multiviews`` 搜索，是否考虑即将加入的文件扩展名。

``mod_mime`` 中的指令将元数据和文件扩展名关联起来；
``core`` 中的指令将节点管理的文件和特定元数据关联起来。
包括 ``ForceType``, ``SetHandler``, ``SetInputFilter`` 以及 ``SetOutputFilter``。
core 指令会覆盖 ``mod_mime`` 的相应配置。

注意，修改文件的元数据不会改变 ``Last-Modified`` 头的字段值。
因此，之前缓存的副本的头字段没变，依然由客户端或者用户代理使用。
如果你修改了文件的元数据，则最好通过 ``touch`` 指令更新文件的最近修改日期，保证所有访问者获取正确的头字段。

多扩展名文件
------------

文件可以有不止一个扩展名；
扩展名的顺序正常情况下是不重要的。
假如 ``welcome.html.fr`` 映射到媒体类型 ``text/html``，其语言映射为法语。
则文件 ``welcome.fr.html`` 也会映射到相同的信息。
如果有多个扩展名都映射到同一种元数据类型，则最右边的类型会被采用。

.. note:: 语言和内容编码除外

假如，``.gif`` 映射成 ``image/gif``, ``.html`` 映射成 ``text/html``，
则文件 ``welcome.gif.html`` 被映射成 ``text/html``。

语言和内容编码的效果是叠加的，因为可以将多个语言标签或者编码方式赋值给某个特定资源。
例如，``welcome.html.en.de`` 在传送时，HTTP 响应头中有 ``Content-Language: en, de`` 和 ``Content-Type: text/html`` 等头字段。

如果多扩展名文件和某个媒体类型以及某个解析器关联起来，需要特别注意。
这通常表示相应请求由特定模块解析，该模块和解析器有关。
假如， ``.imap`` 后缀映射成 ``imap-file`` 解析器（``mod_imagemap``）， ``.html`` 被映射成 ``text/html``，则文件 ``world.imap.html`` 同时与 ``imap-file`` 解析器以及 ``text/html`` 媒体类型关联。
处理 ``world.imap.html`` 时， 用 ``imap-file`` 进行解析。
所以文件还会被当成 ``mod_imagemap`` 的内存映像文件。

如果你只希望文件名用点分隔的最后部分映射成特定的元数据，则不要使用 ``Add*`` 指令。
比如，你想让 ``foo.html.cgi`` 被当成 CGI 脚本处理，但 ``bar.cgi.html`` 不会被当成 CGI 脚本，不能使用 ``AddHandler cgi-script .cgi``，可以这样设置：

.. code-block:: text

    <FilesMatch \.cgi$>
        SetHandler cgi-script
    </FilesMatch>

内容编码
--------

特定媒体类型的文件可能会额外采用特殊方式编码，来简化因特网的数据传输。
这种编码通常指压缩方式，比如 ``gzip`` 方式。
也可能是加密方法，比如 ``pgp`` 或者某种编码方式，比如 ``UUencoding``；
设计成二进制文件进行发送，文件以 ASCII 格式存储。

``HTTP/1.1 RFC`` 第 14.11 节这样描述::
 
 Content-Encoding 实体头字段作为媒体类型的标识符。
 如果存在，它的值表示实体消息的附加内容编码。
 因而为获取 ``Content-Type`` 头字段引用的媒体类型值，必须使用对应的解码机制。
 ``Content-Encoding`` 主要作用是将文档进行压缩，且不失实体的本来媒体类型。

通过多扩展名，可以指定文件的媒体类型和编码方式。

例如，你有一个 ``Microsoft Word`` 文档，采用 ``pkzipped`` 方式压缩。
如果 ``.doc`` 后缀和 ``Microsoft Word`` 文件关联，``.zip`` 后缀和 ``pkzip`` 编码关联，
则 ``Resume.doc.zip`` 会被当成 ``pkzip`` 压缩的 ``Microsoft Word`` 文档。

阿帕奇通过发送 ``Content-Encoding`` 头，告诉浏览器资源的编码方式。

``Content-Encoding: pkzip``

字符集和语言
------------

除了文件类型和文件编码，还有两条重要信息。
即文档的表达语言是什么，采用什么字符集来显示文件内容。
例如，文档用越南语或者西里尔语编写，因此必须采用对应的语言方式展示。
这些信息，同样包含在 HTTP 头中。

字符集，语言，编码方式以及 ``mime`` 类型是内容协商过程中都要用到的信息。
当有多个文档